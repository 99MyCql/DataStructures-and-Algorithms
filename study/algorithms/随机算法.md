# 随机算法

## 洗牌算法

给你一个数组，如何把它随机打乱。面试被问到这个问题时，我的第一反应是：可以调用 python 中的 shuffle 函数。那 shuffle 函数是如何实现的呢？我呆住了。

根据排列组合中的全排列，一个数组随机打乱后有 `n!` 种可能序列。洗牌算法又称随机置乱算法，它的出现则为了实现这种效果。

洗牌算法的步骤十分简单：

- `i` 从 `1~n` ，每次从 `a[i]~a[n]` 中随机取一个数与 `a[i]` 替换。

代码如下：

```c++
for (int i = 1; i <= n; i++)
    swap(a[i], a[random(i, n)])
```

洗牌算法的证明：

- 取第一个数有 `n` 种可能取值，取第二个数有 `n-1` 种可能取值，取第 i 个数有 `n-(i+1)` 种可能取值，那么最终所得序列即有 `n x (n-1) x ... x 2 x 1 = n!` 种可能，每次所得序列的概率都是 `1/n!` 。

## 蓄水池抽样算法

蓄水池抽样算法是洗牌算法的进一步推广。

蓄水池抽样算法用于解决：从 n 个数据中（不知道 n 的大小），随机抽取 m 个**不重复**的样本，每个样本被抽取的概率为 `m/n` 。

每次随机取一个数，随机 m 次可以吗？首先，不知道 n 的大小；其次，计算 n 大小则会浪费时间。因此，我们需要一个更高效的算法。

蓄水池算法的步骤为：

- 对于第 i 个数（1 <= i <= n），当 `i <= m` 时，不进行任何操作；
- 当 `i > m` 时，从 `[1, i]` 中随机一个数 j ：
  - 当 `j <= m` 时，将 `a[i]` 与 `a[j]` 交换；
  - 当 `j > m` 时，不进行任何操作。
- 不断循环，直至 i 等于 n ，前 m 个数即为随机选到的 m 个样本。

证明参考：

- [蓄水池采样算法（Reservoir Sampling）](https://www.cnblogs.com/snowInPluto/p/5996269.html)
